# ä»Šæ—¥è€å©† - NapCat æ’ä»¶

[![Install in NapCat](https://github.com/NapNeko/napcat-plugin-index/raw/pages/button.png)](https://napneko.github.io/napcat-plugin-index?pluginId=napcat-plugin-today-wife)

[![Version](https://img.shields.io/badge/version-1.0.3-blue.svg)](./CHANGELOG.md)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](./LICENSE)
[![NapCat](https://img.shields.io/badge/NapCat-%3E%3D4.14.0-orange.svg)](https://napneko.github.io/)

ä¸€ä¸ªæœ‰è¶£çš„ç¾¤èŠäº’åŠ¨æ’ä»¶ï¼Œå½“ç”¨æˆ·å‘é€åŒ…å«"ä»Šæ—¥è€å©†"å…³é”®è¯çš„æ¶ˆæ¯æ—¶ï¼ŒéšæœºæŠ½å–ä¸€ä½ç¾¤æˆå‘˜ä½œä¸ºä»Šæ—¥è€å©†ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **å…³é”®è¯è§¦å‘**ï¼šå½“ç¾¤èŠæ¶ˆæ¯åŒ…å«"ä»Šæ—¥è€å©†"æ—¶è§¦å‘
- âœ… **å…¬å¹³éšæœº**ï¼šä½¿ç”¨ Math.random() ç¡®ä¿æŠ½å–å…¬å¹³
- âœ… **å¤´åƒå±•ç¤º**ï¼šè‡ªåŠ¨è·å–å¹¶å±•ç¤ºè¢«æŠ½å–æˆå‘˜çš„ QQ å¤´åƒ
- âœ… **@å‘é€è€…**ï¼šå›å¤æ¶ˆæ¯æ—¶è‡ªåŠ¨ @ æ¶ˆæ¯å‘é€è€…
- âœ… **æ¯æ—¥è®°å½•**ï¼šåŒä¸€ç”¨æˆ·æ¯å¤©åªèƒ½æŠ½å–ä¸€æ¬¡ï¼Œé‡å¤è§¦å‘ä¼šæ˜¾ç¤ºä¹‹å‰çš„æŠ½å–ç»“æœ
- âœ… **å†·å´æœºåˆ¶**ï¼šé˜²æ­¢åˆ·å±ï¼Œé»˜è®¤ 30 ç§’å†·å´æ—¶é—´
- âœ… **æ’é™¤è®¾ç½®**ï¼šæ”¯æŒæ’é™¤æœºå™¨äººè´¦å·å’ŒæŒ‡å®šç”¨æˆ·
- âœ… **å†…å­˜å®‰å…¨**ï¼šé™åˆ¶æœ€å¤§è®°å½•æ•°ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œå‹å¥½çš„é”™è¯¯æç¤º

## å®‰è£…æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ NapCat WebUI å®‰è£…ï¼ˆæ¨èï¼‰

1. æ‰“å¼€ NapCat WebUI
2. è¿›å…¥æ’ä»¶å¸‚åœº
3. æœç´¢"ä»Šæ—¥è€å©†"
4. ç‚¹å‡»å®‰è£…

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…

1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ [Release](https://github.com/Sakurakilove/napcat-plugin-today-wife/releases)
2. è§£å‹åˆ° NapCat çš„ `plugins/napcat-plugin-today-wife/` ç›®å½•
3. é‡å¯ NapCat æˆ–åœ¨ WebUI ä¸­åˆ·æ–°æ’ä»¶

## é…ç½®è¯´æ˜

åœ¨ NapCat WebUI çš„æ’ä»¶é…ç½®é¡µé¢ï¼Œå¯ä»¥ä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹ï¼š

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `enabled` | boolean | `true` | æ˜¯å¦å¯ç”¨æ’ä»¶ |
| `keyword` | string | `"ä»Šæ—¥è€å©†"` | è§¦å‘å…³é”®è¯ |
| `cooldown` | number | `30000` | å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ 30 ç§’ |
| `excludeBot` | boolean | `true` | æ˜¯å¦æ’é™¤æœºå™¨äººè´¦å· |
| `excludeUsers` | string | `""` | æ’é™¤çš„ç”¨æˆ· IDï¼Œç”¨é€—å·åˆ†éš”ï¼ˆå¦‚ï¼š`123456,789012`ï¼‰|

## ä½¿ç”¨ç¤ºä¾‹

åœ¨ç¾¤èŠä¸­å‘é€ï¼š
```
ä»Šæ—¥è€å©†
```

æ’ä»¶ä¼šå›å¤ï¼š
```
@å‘é€è€… ä»Šå¤©ä½ çš„è€å©†æ˜¯ @è¢«æŠ½å–æˆå‘˜
[è¢«æŠ½å–æˆå‘˜çš„å¤´åƒå›¾ç‰‡]
```

å¦‚æœåŒä¸€å¤©å†æ¬¡å‘é€ï¼š
```
@å‘é€è€… ä½ ä»Šå¤©å·²ç»æŠ½è¿‡è€å©†äº†ï¼ä½ çš„è€å©†ä¾ç„¶æ˜¯ @è¢«æŠ½å–æˆå‘˜
[è¢«æŠ½å–æˆå‘˜çš„å¤´åƒå›¾ç‰‡]
```

## æŠ€æœ¯å®ç°

### éšæœºç®—æ³•
ä½¿ç”¨ä¼˜åŒ–çš„éšæœºç´¢å¼•é€‰æ‹©ç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ O(1)ï¼š
```typescript
const randomIndex = Math.floor(Math.random() * members.length);
return members[randomIndex];
```

### å¤´åƒè·å–
ä½¿ç”¨ QQ å®˜æ–¹å¤´åƒ APIï¼š
```
https://q1.qlogo.cn/g?b=qq&nk={user_id}&s=640
```

### æ¶ˆæ¯æ ¼å¼
å›å¤æ¶ˆæ¯åŒ…å«ä¸‰ä¸ªæ¶ˆæ¯æ®µï¼š
1. `at` - @æ¶ˆæ¯å‘é€è€…
2. `text` - æ–‡æœ¬å†…å®¹
3. `image` - è¢«æŠ½å–æˆå‘˜å¤´åƒ

### æ•°æ®å­˜å‚¨
- **æ¯æ—¥è®°å½•**ï¼šå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé”®æ ¼å¼ä¸º `groupId:userId`
- **å†·å´è®°å½•**ï¼šå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•
- **å†…å­˜é™åˆ¶**ï¼šæœ€å¤§ä¿ç•™ 10000 æ¡è®°å½•ï¼Œè¶…å‡ºæ—¶è‡ªåŠ¨åˆ é™¤æœ€æ—§è®°å½•
- **è¿‡æœŸæ¸…ç†**ï¼šæ¯å°æ—¶è‡ªåŠ¨æ¸…ç†è¶…è¿‡ 24 å°æ—¶çš„è®°å½•

### å®‰å…¨ç‰¹æ€§
- æ­£åˆ™è¡¨è¾¾å¼é•¿åº¦é™åˆ¶ï¼Œé˜²æ­¢ ReDoS æ”»å‡»
- QQ å·æ ¼å¼éªŒè¯ï¼ˆ5-12 ä½æ•°å­—ï¼‰
- é…ç½®å¯¹è±¡æœ‰æ•ˆæ€§éªŒè¯
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

## é¡¹ç›®ç»“æ„

```
napcat-plugin-today-wife/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts          # ä¸»å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ types.ts          # ç±»å‹å®šä¹‰æ–‡ä»¶
â”œâ”€â”€ dist/                 # ç¼–è¯‘è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ types.js
â”œâ”€â”€ index.mjs             # æ’ä»¶å…¥å£æ–‡ä»¶
â”œâ”€â”€ package.json          # é¡¹ç›®é…ç½®
â”œâ”€â”€ tsconfig.json         # TypeScript é…ç½®
â”œâ”€â”€ CHANGELOG.md          # æ›´æ–°æ—¥å¿—
â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜
```

## å¼€å‘

### ç¯å¢ƒè¦æ±‚
- Node.js >= 18.0.0
- TypeScript >= 5.0.0
- NapCat >= 4.14.0

### å®‰è£…ä¾èµ–
```bash
npm install
```

### ç¼–è¯‘
```bash
npx tsc
```

### å¼€å‘æ¨¡å¼
```bash
npx tsc --watch
```

## æ›´æ–°æ—¥å¿—

è¯¦è§ [CHANGELOG.md](./CHANGELOG.md)

### æœ€æ–°ç‰ˆæœ¬ v1.0.4 æ›´æ–°å†…å®¹
- ğŸ”§ ä¿®å¤å¤šä¸ªç±»å‹å®šä¹‰å’Œé…ç½®é—®é¢˜
- âš¡ï¸ ä¼˜åŒ–éšæœºé€‰æ‹©ç®—æ³•æ€§èƒ½ï¼ˆO(n) â†’ O(1)ï¼‰
- ğŸ›¡ï¸ å¢å¼ºå®‰å…¨æ€§ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼å’Œ ReDoS æ”»å‡»
- ğŸ› ä¿®å¤å†·å´æ—¶é—´è®¾ç½®é€»è¾‘ï¼Œä»…åœ¨æˆåŠŸåè®¾ç½®
- âœ¨ æ·»åŠ é…ç½®åŠ è½½å’Œé”™è¯¯å¤„ç†å®Œå–„

## è®¸å¯è¯

[MIT License](./LICENSE)

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ç›¸å…³é“¾æ¥

- [NapCat å®˜æ–¹æ–‡æ¡£](https://napneko.github.io/)
- [NapCat æ’ä»¶å•†åº—](https://napneko.github.io/napcat-plugin-index)
- [NapCat æ’ä»¶æ¨¡æ¿](https://github.com/NapNeko/napcat-plugin-template)
- [æ’ä»¶ GitHub ä»“åº“](https://github.com/Sakurakilove/napcat-plugin-today-wife)

## è‡´è°¢

æ„Ÿè°¢ [NapCat](https://github.com/NapNeko/NapCatQQ) å›¢é˜Ÿæä¾›çš„ä¼˜ç§€æ¡†æ¶å’Œæ’ä»¶ç³»ç»Ÿã€‚
